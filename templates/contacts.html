{% extends "base.html" %}
{% block title %}Kontakte{% endblock %}
{% block header_title %}Kontakte (global){% endblock %}

{% block app_content %}

<div class="space-y-6">

  <!-- Filter -->
  <section class="rounded-2xl border border-slate-200 bg-white p-5 shadow-sm">
    <form method="get" action="{{ url_for('contacts') }}" class="flex gap-2 items-center">
      <label class="text-xs text-slate-600">
        Kanal:
      </label>
      <select name="channel"
              class="rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-700 focus:border-sky-400 focus:outline-none focus:ring-1 focus:ring-sky-400">
        <option value="all" {% if channel == 'all' %}selected{% endif %}>Alle Kanäle</option>
        <option value="phone" {% if channel == 'phone' %}selected{% endif %}>Telefon</option>
        <option value="email" {% if channel == 'email' %}selected{% endif %}>E-Mail</option>
        <option value="meeting" {% if channel == 'meeting' %}selected{% endif %}>Meeting</option>
        <option value="chat" {% if channel == 'chat' %}selected{% endif %}>Chat</option>
      </select>
      <button type="submit"
              class="inline-flex items-center rounded-lg bg-slate-900 px-3 py-1.5 text-xs font-semibold text-white hover:bg-slate-800">
        Filtern
      </button>
    </form>
  </section>

  <!-- Tabelle -->
  <section class="rounded-2xl border border-slate-200 bg-white p-5 shadow-sm">
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-slate-200 text-xs">
        <thead class="bg-slate-50">
          <tr class="text-left font-semibold uppercase tracking-wide text-slate-500">
            <th class="px-3 py-2">Datum</th>
            <th class="px-3 py-2">Kunde</th>
            <th class="px-3 py-2">Art</th>
            <th class="px-3 py-2">Betreff</th>
            <th class="px-3 py-2">Mitarbeiter</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-100 bg-white">
        {% for contact in pagination.items %}
          <tr class="hover:bg-slate-50">
            <td class="px-3 py-2 text-slate-700">
              {{ contact.contact_at.strftime('%d.%m.%Y %H:%M') }}
            </td>
            <td class="px-3 py-2 text-slate-800">
              <a href="{{ url_for('customer_detail', customer_id=contact.customer.id) }}"
                 class="hover:text-sky-600">
                {{ contact.customer.company }}
              </a>
            </td>
            <td class="px-3 py-2">
              <span class="inline-flex items-center rounded-full bg-slate-100 px-2 py-0.5 text-[11px] font-medium text-slate-700">
                {{ contact.channel }}
              </span>
            </td>
            <td class="px-3 py-2 text-slate-800">
              {{ contact.subject }}
            </td>
            <td class="px-3 py-2 text-slate-600">
              {% if contact.user %}
                {{ contact.user.username }}
              {% else %}
                –
              {% endif %}
            </td>
          </tr>
        {% else %}
          <tr>
            <td colspan="5" class="px-3 py-4 text-center text-slate-500">
              Keine Kontakte gefunden.
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div class="mt-4 flex items-center justify-between text-xs text-slate-600">
      {% if pagination.has_prev %}
        <a href="{{ url_for('contacts', channel=channel, page=pagination.prev_num) }}"
           class="px-3 py-1 rounded border border-slate-300 hover:bg-slate-100">
           « Zurück
        </a>
      {% else %}
        <span></span>
      {% endif %}

      <span>
        Seite {{ pagination.page }} / {{ pagination.pages or 1 }}
      </span>

      {% if pagination.has_next %}
        <a href="{{ url_for('contacts', channel=channel, page=pagination.next_num) }}"
           class="px-3 py-1 rounded border border-slate-300 hover:bg-slate-100">
           Weiter »
        </a>
      {% else %}
        <span></span>
      {% endif %}
    </div>

  </section>

</div>
{% endblock %}
