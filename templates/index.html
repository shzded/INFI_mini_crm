{% extends "base.html" %}
{% block title %}Übersicht{% endblock %}
{% block header_title %}Dashboard · Überblick{% endblock %}

{% block app_content %}
<div class="space-y-6">

  <!-- Kunden-Bereich -->
  <section class="rounded-2xl border border-slate-200 bg-white p-5 shadow-sm">
    <div class="flex flex-col gap-3 md:flex-row md:items-center md:justify-between mb-3">
      <div>
        <h2 class="text-base font-semibold text-slate-900">Kunden</h2>
        <p class="text-xs text-slate-500">
          Suche nach Name, E-Mail oder Telefonnummer. Anzeige der letzten Aktivitäten.
        </p>
      </div>
      <form method="get" action="{{ url_for('index') }}" class="flex gap-2">
        <input type="search" name="q"
               placeholder="Kunde suchen..."
               value="{{ q_customers or '' }}"
               class="w-52 md:w-72 rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-700 placeholder:text-slate-400 focus:border-sky-400 focus:outline-none focus:ring-1 focus:ring-sky-400">
        <button type="submit"
                class="inline-flex items-center rounded-lg bg-slate-900 px-3 py-1.5 text-xs font-semibold text-white hover:bg-slate-800">
          Suchen
        </button>
      </form>
    </div>

    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-slate-200 text-xs">
        <thead class="bg-slate-50">
          <tr class="text-left font-semibold uppercase tracking-wide text-slate-500">
            <th class="px-3 py-2">Kund#</th>
            <th class="px-3 py-2">Name</th>
            <th class="px-3 py-2">E-Mail</th>
            <th class="px-3 py-2">Aktivität</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-100 bg-white">
        {% for customer, days in customers %}
          <tr class="hover:bg-slate-50">
            <td class="px-3 py-2 text-slate-500">
              {{ customer.id }}
            </td>
            <td class="px-3 py-2">
              <a href="{{ url_for('customer_detail', customer_id=customer.id) }}"
                 class="font-medium text-slate-900 hover:text-sky-600">
                {{ customer.company }}
              </a>
              {% if customer.contact_name %}
                <div class="text-[11px] text-slate-500">
                  {{ customer.contact_name }}
                </div>
              {% endif %}
            </td>
            <td class="px-3 py-2 text-slate-700">
              {{ customer.email or "—" }}
            </td>
            <td class="px-3 py-2">
              {% if days is not none %}
                <span class="inline-flex items-center rounded-full bg-emerald-50 px-2 py-0.5 text-[11px] font-medium text-emerald-700">
                  vor {{ days }} Tag{% if days != 1 %}en{% endif %}
                </span>
              {% else %}
                <span class="inline-flex items-center rounded-full bg-slate-50 px-2 py-0.5 text-[11px] text-slate-500">
                  kein Kontakt erfasst
                </span>
              {% endif %}
            </td>
          </tr>
        {% else %}
          <tr>
            <td colspan="4" class="px-3 py-4 text-center text-slate-500">
              Keine Kunden gefunden.
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </section>

  <!-- Bestellungen-Bereich -->
  <section class="rounded-2xl border border-slate-200 bg-white p-5 shadow-sm">
    <div class="flex flex-col gap-3 md:flex-row md:items-center md:justify-between mb-3">
      <div>
        <h2 class="text-base font-semibold text-slate-900">Bestellungen (global)</h2>
        <p class="text-xs text-slate-500">
          Neueste Bestellungen über alle Kunden, sortiert nach Datum.
        </p>
      </div>
      <form method="get" action="{{ url_for('index') }}" class="flex gap-2">
        <input type="search" name="q_orders"
               placeholder="Bestellnr. oder Kunde..."
               value="{{ q_orders or '' }}"
               class="w-52 md:w-72 rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-700 placeholder:text-slate-400 focus:border-sky-400 focus:outline-none focus:ring-1 focus:ring-sky-400">
        <button type="submit"
                class="inline-flex items-center rounded-lg bg-slate-900 px-3 py-1.5 text-xs font-semibold text-white hover:bg-slate-800">
          Filtern
        </button>
      </form>
    </div>

    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-slate-200 text-xs">
        <thead class="bg-slate-50">
          <tr class="text-left font-semibold uppercase tracking-wide text-slate-500">
            <th class="px-3 py-2">Bestellnr.</th>
            <th class="px-3 py-2">Kunde</th>
            <th class="px-3 py-2">Datum</th>
            <th class="px-3 py-2 text-right">Summe</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-100 bg-white">
        {% for order in orders %}
          <tr class="hover:bg-slate-50">
            <td class="px-3 py-2 font-mono text-[11px] text-slate-800">
              {{ order.order_number }}
            </td>
            <td class="px-3 py-2 text-slate-800">
              <a href="{{ url_for('customer_detail', customer_id=order.customer.id) }}"
                 class="hover:text-sky-600">
                {{ order.customer.company }}
              </a>
            </td>
            <td class="px-3 py-2 text-slate-700">
              {{ order.order_date.strftime('%d.%m.%Y') }}
            </td>
            <td class="px-3 py-2 text-right text-slate-900">
              {{ "%.2f"|format(order.total_amount or 0) }} €
            </td>
          </tr>
        {% else %}
          <tr>
            <td colspan="4" class="px-3 py-4 text-center text-slate-500">
              Keine Bestellungen gefunden.
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </section>

  <!-- Kontakte-Bereich -->
  <section class="rounded-2xl border border-slate-200 bg-white p-5 shadow-sm">
    <div class="flex flex-col gap-3 md:flex-row md:items-center md:justify-between mb-3">
      <div>
        <h2 class="text-base font-semibold text-slate-900">Kontakte (global)</h2>
        <p class="text-xs text-slate-500">
          Letzte Kontakte über alle Kunden, chronologisch absteigend.
        </p>
      </div>
      <form method="get" action="{{ url_for('index') }}" class="flex gap-2 items-center">
        <select name="channel"
                class="rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-700 focus:border-sky-400 focus:outline-none focus:ring-1 focus:ring-sky-400">
          <option value="all"  {% if channel == 'all' %}selected{% endif %}>Alle Kanäle</option>
          <option value="phone" {% if channel == 'phone' %}selected{% endif %}>Telefon</option>
          <option value="email" {% if channel == 'email' %}selected{% endif %}>E-Mail</option>
          <option value="meeting" {% if channel == 'meeting' %}selected{% endif %}>Meeting</option>
          <option value="chat" {% if channel == 'chat' %}selected{% endif %}>Chat</option>
        </select>
        <button type="submit"
                class="inline-flex items-center rounded-lg bg-slate-900 px-3 py-1.5 text-xs font-semibold text-white hover:bg-slate-800">
          Filtern
        </button>
      </form>
    </div>

    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-slate-200 text-xs">
        <thead class="bg-slate-50">
          <tr class="text-left font-semibold uppercase tracking-wide text-slate-500">
            <th class="px-3 py-2">Datum</th>
            <th class="px-3 py-2">Kunde</th>
            <th class="px-3 py-2">Art</th>
            <th class="px-3 py-2">Betreff</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-100 bg-white">
        {% for contact in contacts %}
          <tr class="hover:bg-slate-50">
            <td class="px-3 py-2 text-slate-700">
              {{ contact.contact_at.strftime('%d.%m.%Y %H:%M') }}
            </td>
            <td class="px-3 py-2 text-slate-800">
              <a href="{{ url_for('customer_detail', customer_id=contact.customer.id) }}"
                 class="hover:text-sky-600">
                {{ contact.customer.company }}
              </a>
            </td>
            <td class="px-3 py-2">
              <span class="inline-flex items-center rounded-full bg-slate-100 px-2 py-0.5 text-[11px] font-medium text-slate-700">
                {{ contact.channel }}
              </span>
            </td>
            <td class="px-3 py-2 text-slate-700">
              {{ contact.subject }}
            </td>
          </tr>
        {% else %}
          <tr>
            <td colspan="4" class="px-3 py-4 text-center text-slate-500">
              Keine Kontakte gefunden.
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </section>

</div>
{% endblock %}
